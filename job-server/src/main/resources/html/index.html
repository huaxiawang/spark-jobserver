<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html">
  <head>
    <title>Spark Jobserver</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="html/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="html/css/index.css" rel="stylesheet">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script src="html/bootstrap/js/bootstrap.min.js"></script>
    <script src="html/js/spark-jobserver-ui.js"></script>
  </head>
  <body>
    <div class="page-header">
      <h1>Spark Job Server</h1>
    </div>
    <ul class="nav nav-tabs nav-justified" id="navTabs">
      <li class="active"><a href="#jobs" data-toggle="tab">Jobs</a></li>
      <li><a href="#contexts" data-toggle="tab">Contexts</a></li>
      <li><a href="#jars" data-toggle="tab">Jars</a></li>
    </ul>
    <div class="tab-content">
      <div class="tab-pane active" id="jobs">
        <div class="job-submit">
          <form enctype="multipart/form-data">
            <div>
              <label>Input Data:&nbsp;&nbsp;&thinsp;&thinsp;&thinsp;</label>
              <input id="job-input" type="text" placeholder="input.state=MI,input.specialty=Neurology">
            </div>
            <div>
              <label>App Name:&nbsp;&nbsp;&thinsp;&thinsp;</label>
              <input id="job-name" type="text" placeholder="predict">
            </div>
            <div>
              <label>Class Path:&nbsp;&nbsp;</label>
              <input id="job-class" type="text" placeholder="spark.predict.predictJob">
            </div>
            <input id="job-submit-button" type="submit">
          </form>
        </div>
        <div class="panel panel-info">
          <div class="panel-heading">Running Jobs</div>
          <div class="panel-body">
            <table class="table table-striped" id="runningJobsTable">
              <thead>
                <tr>
                  <th>Id</th>
                  <th>Classpath</th>
                  <th>Context</th>
                  <th>Start Time</th>
                  <th>Duration</th>
                </tr>
              </thead>
              <tbody>
              </tbody>
            </table>
          </div>
        </div>
        <div class="panel panel-success">
          <div class="panel-heading">Completed Jobs</div>
          <div class="panel-body">
            <table class="table table-striped" id="completedJobsTable">
              <thead>
                <tr>
                  <th>Id</th>
                  <th>Classpath</th>
                  <th>Context</th>
                  <th>Start Time</th>
                  <th>Duration</th>
                </tr>
              </thead>
              <tbody>
              </tbody>
            </table>
          </div>
        </div>
        <div class="panel panel-danger">
          <div class="panel-heading">Failed Jobs</div>
          <div class="panel-body">
            <table class="table table-striped" id="failedJobsTable">
              <thead>
                <tr>
                  <th>Id</th>
                  <th>Classpath</th>
                  <th>Context</th>
                  <th>Start Time</th>
                  <th>Duration</th>
                </tr>
              </thead>
              <tbody>
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <div class="tab-pane" id="contexts">
        <div class="panel">
          <div class="panel-heading"></div>
          <div class="panel-body">
            <table class="table table-striped" id="contextsTable">
              <thead>
                <tr>
                  <th>Name</th>
                </tr>
              </thead>
              <tbody>
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <div class="tab-pane" id="jars">
        <div class="jar-submit">
          <form enctype="multipart/form-data">
            <div>
              <label>Upload file:&nbsp;&nbsp;</label>
              <input id="upload-file" name="file" type="file">
            </div>
            <div>
              <label>App Name:&nbsp;&nbsp;</label>
              <input id="upload-app" type="text" placeholder="App Name">
            </div>
            <input id="upload-button" type="submit" value="Upload">
          </form>
          <div id="job-submit-status"></div>
        </div>
        <div class="panel">
          <div class="panel-heading"></div>
          <div class="panel-body">
            <table class="table table-striped" id="jarsTable">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Deployment Time</th>
                </tr>
              </thead>
              <tbody>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
    <div class="tooltip" style="display: none">
    </div>

    <script>
      var validated = false, file;
      $(":file").change(function () {
        file = this.files[0];
        var name = file.name;
        var type = file.type;
        var size = file.size;

        if (name.length < 1) {
        }
        else if (size > 30000000) {
          alert("File is too big!");
        }
        else if (type != 'application/java-archive') {
          alert("File doesn't match jar!")
        }
        else {
          validated = true;
        }
      });

      $("#upload-button").click(function(e) {
        e.preventDefault();
        var appName = $("#upload-app").val();
        if(!validated){
          alert("File is not of the right format or too big!")
        }
        else if (appName == undefined || appName == ""){
          alert("App Name cannot be empty!");
        }
        else {
          $.ajax({
            url: "/jars/"+appName ,
            type: "POST",
            data: file,
            cache: false,
            contentType: false,
            processData: false,
            complete: function (request) {
              getJars();
              console.log(request.responseText);
            }
          });

        }
      });

      $("#job-submit-button").click(function (e) {
        e.preventDefault();
        var appName = $("#job-name").val();
        var classPath = $("#job-class").val();
        var inputs = $("#job-input").val();
        $.ajax({
          url: "/jobs?appName="+appName+"&classPath="+classPath,
          type: "POST",
          data: inputs,
          cache: false,
          contentType: false,
          processData: false,
          complete: function (request) {
            getJobs();
            //$("#job-submit-status").text(request.responseText);
            console.log(request.responseText);
          }
        })
      });
    </script>
  </body>
</html>
